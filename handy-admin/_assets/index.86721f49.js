let e=document.createElement("style");e.innerHTML="",document.head.appendChild(e);import{q as a,ab as t,a7 as n,f as l,x as o,g as c,v as i,r as s,o as d,c as r,a as m,i as u,aa as p,M as f,s as y,w as v,b}from"./index.a841be5a.js";import{i as h,j as g,s as k,u as w,k as I,l as C,b as F,m as R,e as K,g as L,Q as S,n as N}from"./SchemaForm.022d367d.js";var _=a({name:"access-tree",components:{[t.name]:t,[n.name]:n},emits:["update:value"],props:{value:{type:Array,default:()=>[]}},setup(e,{emit:a}){const t=l({treeData:[],spinning:!1,replaceFields:{key:"id"}}),n=(e,a=-1)=>e.filter((e=>e.moduleId==a)).map((a=>({...a,title:a.moduleName||a.actionName,children:n(e,a.id)}))),s=o({get:()=>e.value,set:e=>a("update:value",Array.isArray(e)?e:e.checked)});c((async()=>{t.spinning=!0;const{result:e}=await h().finally((()=>t.spinning=!1));t.treeData=n(e)}));const d=(e,a=[])=>e.eventKey?(a.push(e.eventKey),d(e.vcTreeNode,a)):a,r=(e,a=[])=>e?.children.length>0?(console.log(e.children,"children"),e.children.reduce(((e,a)=>(a.children.length>0&&e.push(...r(a,e),[]),e.concat([a.id]))),a)):a;return{...i(t),checkedKeys:s,onCheck:(e,{node:a,checked:t})=>{let n=s.value;if(t)n=[...new Set([...s.value,...e.checked,...d(a.vcTreeNode),...r(a.dataRef)])];else{const t=r(a.dataRef);console.log(t,"childrenKeys"),n=t.length>0?e.checked.filter((e=>!t.includes(e))):e.checked;(a.vcTreeNode?.dataRef?.children?.map((e=>e.id))||[]).some((e=>n.includes(e)))||(n=n.filter((e=>e!=a.vcTreeNode?.eventKey)))}s.value=n}}}});const x=u("data-v-5191bb5a"),T=x((function(e,a,t,n,l,o){const c=s("a-tree"),i=s("a-spin");return d(),r(i,{spinning:e.spinning},{default:x((()=>[m(c,{checkable:"",checkStrictly:"",selectable:!1,"tree-data":e.treeData,"replace-fields":e.replaceFields,checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":a[1]||(a[1]=a=>e.checkedKeys=a),onCheck:e.onCheck},null,8,["tree-data","replace-fields","checkedKeys","onCheck"])])),_:1},8,["spinning"])}));_.render=T,_.__scopeId="data-v-5191bb5a";const O={style:{width:"auto"},formItemLayout:{labelCol:{span:4},wrapperCol:{span:20}},formItem:[{type:"input",label:"角色名称",field:"roleName",value:"",props:{placeholder:"请输入角色名称"},rules:[{required:!0,message:"角色名称不能为空"}]},{type:"textarea",label:"描述",field:"roleCode",value:"",props:{placeholder:"角色描述"}},{type:p(_),label:"资源",field:"accessIdsList",value:[],asyncValue:async(e,a)=>{const{id:t}=a?.props.fields,n=await g(t);return console.log(n),n.result.map((e=>e.accessId))}}]};var D=a({name:"edit-modal",components:{[f.name]:f,SchemaForm:k},props:{remove:{type:Function},fields:{type:Object},callback:{type:Function}},setup(e){const a=y(null),t=l({visible:!0,confirmLoading:!1,dynamicValidateForm:O});return{...i(t),handleOk:async()=>{t.confirmLoading=!0,a.value.validate().then((async n=>{const{roleName:l,roleId:o,roleCode:c,accessIdsList:i}=a.value.modelRef,s={roleName:l,roleId:o,roleCode:c,accessIdsList:i.toString()};await w(I(s),{ref:t,loadingName:"confirmLoading"});t.visible=!1,e.callback&&e.callback()})).catch((e=>{console.log("error",e),t.confirmLoading=!1}))},dynamicForm:a}}});const V=u("data-v-4a5c1ab7"),j=V((function(e,a,t,n,l,o){const c=s("SchemaForm"),i=s("a-modal");return d(),r(i,{title:"编辑账号",visible:e.visible,"onUpdate:visible":a[1]||(a[1]=a=>e.visible=a),"confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.handleOk},{default:V((()=>[m(c,{ref:"dynamicForm",fields:e.fields,"dynamic-validate-form":e.dynamicValidateForm},null,8,["fields","dynamic-validate-form"])])),_:1},8,["visible","confirm-loading","afterClose","onOk"])}));D.render=j,D.__scopeId="data-v-4a5c1ab7";const U=[{title:"角色名",dataIndex:"roleName"},{title:"描述",dataIndex:"roleCode"},{title:"创建时间",dataIndex:"createTime",slots:{customRender:"createTime"},slotsType:"format",slotsFunc:e=>e},{title:"创建者",dataIndex:"createUser"},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",key:"fileid",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},a)=>{await C(e.roleId),a()}},{type:"button",key:"fileid",text:"编辑",props:{type:"warning"},func:({record:e},a)=>F(D,{fields:e,callback:a})}]}];var A=a({name:"add-modal",components:{[f.name]:f,SchemaForm:k},props:{remove:{type:Function},callback:{type:Function}},setup(e){const a=y(null),t=l({visible:!0,confirmLoading:!1,dynamicValidateForm:O});return{...i(t),handleOk:()=>{t.confirmLoading=!0,a.value.validate().then((async n=>{const l={...a.value.modelRef,roles:a.value.modelRef.roles.toString()};await w(R(l),{ref:t,loadingName:"confirmLoading"}),t.visible=!1,e.callback&&e.callback()})).catch((e=>{console.log("error",e),t.confirmLoading=!1}))},dynamicForm:a}}});const q=u("data-v-49db0f91"),B=q((function(e,a,t,n,l,o){const c=s("SchemaForm"),i=s("a-modal");return d(),r(i,{title:"新增账号",visible:e.visible,"onUpdate:visible":a[1]||(a[1]=a=>e.visible=a),"confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.handleOk},{default:q((()=>[m(c,{ref:"dynamicForm","dynamic-validate-form":e.dynamicValidateForm},null,8,["dynamic-validate-form"])])),_:1},8,["visible","confirm-loading","afterClose","onOk"])}));A.render=B,A.__scopeId="data-v-49db0f91";var M=a({components:{BasicTable:K},setup(){const e=y(null),a=l({data:[],uploading:!1,tableLoading:!1,rowSelection:{onChange:(e,t)=>{a.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),t=o((()=>0==a.rowSelection.selectedRowKeys.length));return{...i(a),tableRef:e,columns:U,getRolePage:L,isDisabled:t,addItem:()=>{F(A,{callback:()=>{}})},deleteItems:()=>{f.confirm({title:"提示",icon:m(S),content:"您确定要删除所有选中吗？",onOk:async()=>{await N(a.rowSelection.selectedRowKeys.toString()),e.value.refreshTableData(),a.rowSelection.selectedRowKeys=[]}})}}}});const P={class:"content"},E=b("添加"),H=b("删除");M.render=function(e,a,t,n,l,o){const c=s("a-button"),i=s("BasicTable");return d(),r("div",P,[m(i,{ref:"tableRef",columns:e.columns,"get-list-func":e.getRolePage,rowKey:"roleId","row-selection":e.rowSelection},{title:v((()=>[m(c,{onClick:e.addItem,type:"primary"},{default:v((()=>[E])),_:1},8,["onClick"]),m(c,{onClick:e.deleteItems,disabled:e.isDisabled,type:"primary"},{default:v((()=>[H])),_:1},8,["onClick","disabled"])])),_:1},8,["columns","get-list-func","row-selection"])])};export default M;
