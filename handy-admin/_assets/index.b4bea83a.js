let e=document.createElement("style");e.innerHTML="",document.head.appendChild(e);import{q as a,ab as t,a7 as l,f as n,x as o,g as c,v as i,r as s,o as d,c as r,a as m,i as u,aa as f,M as p,s as y,w as v,b}from"./index.fb302126.js";import{i as h,j as g,s as k,u as w,k as I,l as C,b as F,m as L,e as R,g as K}from"./SchemaForm.df663f5b.js";var S=a({name:"access-tree",components:{[t.name]:t,[l.name]:l},emits:["update:value"],props:{value:{type:Array,default:()=>[]}},setup(e,{emit:a}){const t=n({treeData:[],spinning:!1,replaceFields:{key:"id"}}),l=(e,a=-1)=>e.filter((e=>e.moduleId==a)).map((a=>({...a,title:a.moduleName||a.actionName,children:l(e,a.id)}))),s=o({get:()=>e.value,set:e=>a("update:value",Array.isArray(e)?e:e.checked)});c((async()=>{t.spinning=!0;const{result:e}=await h().finally((()=>t.spinning=!1));t.treeData=l(e)}));const d=(e,a=[])=>e.eventKey?(a.push(e.eventKey),d(e.vcTreeNode,a)):a,r=(e,a=[])=>e?.children.length>0?(console.log(e.children,"children"),e.children.reduce(((e,a)=>(a.children.length>0&&e.push(...r(a,e),[]),e.concat([a.id]))),a)):a;return{...i(t),checkedKeys:s,onCheck:(e,{node:a,checked:t})=>{let l=s.value;if(t)l=[...new Set([...s.value,...e.checked,...d(a.vcTreeNode),...r(a.dataRef)])];else{const t=r(a.dataRef);console.log(t,"childrenKeys"),l=t.length>0?e.checked.filter((e=>!t.includes(e))):e.checked;(a.vcTreeNode?.dataRef?.children?.map((e=>e.id))||[]).some((e=>l.includes(e)))||(l=l.filter((e=>e!=a.vcTreeNode?.eventKey)))}s.value=l}}}});const N=u("data-v-5191bb5a"),_=N((function(e,a,t,l,n,o){const c=s("a-tree"),i=s("a-spin");return d(),r(i,{spinning:e.spinning},{default:N((()=>[m(c,{checkable:"",checkStrictly:"",selectable:!1,"tree-data":e.treeData,"replace-fields":e.replaceFields,checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":a[1]||(a[1]=a=>e.checkedKeys=a),onCheck:e.onCheck},null,8,["tree-data","replace-fields","checkedKeys","onCheck"])])),_:1},8,["spinning"])}));S.render=_,S.__scopeId="data-v-5191bb5a";const x={style:{width:"auto"},formItemLayout:{labelCol:{span:4},wrapperCol:{span:20}},formItem:[{type:"input",label:"角色名称",field:"roleName",value:"",props:{placeholder:"请输入角色名称"},rules:[{required:!0,message:"角色名称不能为空"}]},{type:"textarea",label:"描述",field:"roleCode",value:"",props:{placeholder:"角色描述"}},{type:f(S),label:"资源",field:"accessIdsList",value:[],asyncValue:async(e,a)=>{const{id:t}=a?.props.fields,l=await g(t);return console.log(l),l.result.map((e=>e.accessId))}}]};var T=a({name:"edit-modal",components:{[p.name]:p,SchemaForm:k},props:{remove:{type:Function},fields:{type:Object},callback:{type:Function}},setup(e){const a=y(null),t=n({visible:!0,confirmLoading:!1,dynamicValidateForm:x});return{...i(t),handleOk:async()=>{t.confirmLoading=!0,a.value.validate().then((async l=>{const{roleName:n,roleId:o,roleCode:c,accessIdsList:i}=a.value.modelRef,s={roleName:n,roleId:o,roleCode:c,accessIdsList:i.toString()};await w(I(s),{ref:t,loadingName:"confirmLoading"});t.visible=!1,e.callback&&e.callback()})).catch((e=>{console.log("error",e),t.confirmLoading=!1}))},dynamicForm:a}}});const O=u("data-v-4a5c1ab7"),D=O((function(e,a,t,l,n,o){const c=s("SchemaForm"),i=s("a-modal");return d(),r(i,{title:"编辑账号",visible:e.visible,"onUpdate:visible":a[1]||(a[1]=a=>e.visible=a),"confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.handleOk},{default:O((()=>[m(c,{ref:"dynamicForm",fields:e.fields,"dynamic-validate-form":e.dynamicValidateForm},null,8,["fields","dynamic-validate-form"])])),_:1},8,["visible","confirm-loading","afterClose","onOk"])}));T.render=D,T.__scopeId="data-v-4a5c1ab7";const V=[{title:"角色名",dataIndex:"roleName"},{title:"描述",dataIndex:"roleCode"},{title:"创建时间",dataIndex:"createTime",slots:{customRender:"createTime"},slotsType:"format",slotsFunc:e=>e},{title:"创建者",dataIndex:"createUser"},{title:"操作",dataIndex:"action",width:200,slots:{customRender:"action"},actions:[{type:"popconfirm",key:"fileid",text:"删除",permission:{action:"delete",effect:"disabled"},props:{type:"danger"},func:async({record:e},a)=>{await C(e.roleId),a()}},{type:"button",key:"fileid",text:"编辑",props:{type:"warning"},func:({record:e},a)=>F(T,{fields:e,callback:a})}]}];var j=a({name:"add-modal",components:{[p.name]:p,SchemaForm:k},props:{remove:{type:Function},callback:{type:Function}},setup(e){const a=y(null),t=n({visible:!0,confirmLoading:!1,dynamicValidateForm:x});return{...i(t),handleOk:()=>{t.confirmLoading=!0,a.value.validate().then((async l=>{const n={...a.value.modelRef,roles:a.value.modelRef.roles.toString()};await w(L(n),{ref:t,loadingName:"confirmLoading"}),t.visible=!1,e.callback&&e.callback()})).catch((e=>{console.log("error",e),t.confirmLoading=!1}))},dynamicForm:a}}});const U=u("data-v-49db0f91"),A=U((function(e,a,t,l,n,o){const c=s("SchemaForm"),i=s("a-modal");return d(),r(i,{title:"新增账号",visible:e.visible,"onUpdate:visible":a[1]||(a[1]=a=>e.visible=a),"confirm-loading":e.confirmLoading,afterClose:e.remove,onOk:e.handleOk},{default:U((()=>[m(c,{ref:"dynamicForm","dynamic-validate-form":e.dynamicValidateForm},null,8,["dynamic-validate-form"])])),_:1},8,["visible","confirm-loading","afterClose","onOk"])}));j.render=A,j.__scopeId="data-v-49db0f91";var q=a({components:{BasicTable:R},setup(){const e=y(null),a=n({data:[],uploading:!1,tableLoading:!1,rowSelection:{onChange:(e,t)=>{a.rowSelection.selectedRowKeys=e},selectedRowKeys:[]}}),t=o((()=>0==a.rowSelection.selectedRowKeys.length));return{...i(a),tableRef:e,columns:V,getRolePage:K,isDisabled:t,addItem:()=>{F(j,{callback:()=>{}})},deleteItems:()=>{console.log(a.rowSelection.selectedRowKeys.toString())}}}});const B={class:"content"},M=b("添加"),P=b("删除");q.render=function(e,a,t,l,n,o){const c=s("a-button"),i=s("BasicTable");return d(),r("div",B,[m(i,{ref:"tableRef",columns:e.columns,"get-list-func":e.getRolePage,rowKey:"roleId","row-selection":e.rowSelection},{title:v((()=>[m(c,{onClick:e.addItem,type:"primary"},{default:v((()=>[M])),_:1},8,["onClick"]),m(c,{onClick:e.deleteItems,disabled:e.isDisabled,type:"primary"},{default:v((()=>[P])),_:1},8,["onClick","disabled"])])),_:1},8,["columns","get-list-func","row-selection"])])};export default q;
